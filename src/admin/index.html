<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="HA4E content editor â€“ sign in to edit site content.">
  <title>HA4E Content Editor</title>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url">
  <script>
    (function() {
      var origAddEventListener = window.addEventListener;
      window.addEventListener = function(type, listener, options) {
        if (type === 'message' && listener) {
          var wrapped = function(e) {
            if (typeof e.data !== 'string') return;
            return listener.call(this, e);
          };
          return origAddEventListener.call(this, type, wrapped, options);
        }
        return origAddEventListener.apply(this, arguments);
      };
    })();
  </script>
  <script>
    (function() {
      var retryDelays = [0, 300, 1000, 2000];
      function dispatchAuth(msg) {
        if (msg == null) return;
        var data = typeof msg === 'string' ? msg : JSON.stringify(msg);
        var prefix = 'authorization:github:success:';
        if (data.indexOf(prefix) === 0) {
          try {
            var payload = data.slice(prefix.length);
            var obj = JSON.parse(payload);
            data = prefix + JSON.stringify(obj);
          } catch (e) {}
        }
        window.dispatchEvent(new MessageEvent('message', { data: data, origin: window.location.origin }));
      }
      function applyPending() {
        try {
          var msg = localStorage.getItem('cms-oauth-pending');
          if (msg) retryDelays.forEach(function(d) { setTimeout(function() { dispatchAuth(msg); }, d); });
        } catch (e) {}
      }
      window.addEventListener('storage', function(e) {
        if (e.key === 'cms-oauth-pending' && e.newValue) applyPending();
      });
      window.addEventListener('focus', function() { applyPending(); });
      document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible') applyPending();
      });
      retryDelays.forEach(function(delay) {
        setTimeout(function() {
          try {
            var msg = localStorage.getItem('cms-oauth-pending');
            if (msg) retryDelays.forEach(function(d) { setTimeout(function() { dispatchAuth(msg); }, d); });
          } catch (e) {}
        }, delay);
      });
      setTimeout(function() {
        try { if (localStorage.getItem('cms-oauth-pending')) localStorage.removeItem('cms-oauth-pending'); } catch (e) {}
      }, 12000);
    })();
  </script>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js" defer></script>
</head>
<body>
  <main id="nc-root" role="main"></main>
</body>
</html>
